# 简介

本文主要记录战斗系统中涉及到的各个模块的设计思路，一是为了作为代码文档，二是记录关于系统设计的灵感。

将战斗流程分为三个大的部分：战斗指令模块、战斗计算模块和内容展示模块。

# 战斗指令模块

## 简介

该系统与战斗细节无关，主要目的是为了之后联机、录像等系统的扩展服务。

## 目的

战斗指令系统用于隔离战斗计算系统和操作输入源，因为操作输入源可能有多种，例如玩家操作、本机 AI 指令、录像、联机服务器指令等。所以在战斗指令系统中，将这些可能的输入源统一转化为战斗计算系统可以接受的指令传入战斗计算系统，然后战斗计算系统去改变数据并修改战斗内容展示模块。

基于以上目的，客户端的版本号需要有比较严格的管理，因为指令系统的修改将导致联机协议的不兼容。



# 技能设计

## 基本流程

每个回合的流程为：回合开始阶段(begin)、抽牌阶段(draw)、准备阶段1(prepare1)、战斗选择阶段(select)、战斗响应阶段(response)、战斗结算阶段(result)、弃牌阶段(discard)、回合结束阶段(end)。

技能作用对象分为：生物(creature)、英雄(hero)。（待补充）
 
所有技能都是一个 function，并且都有技能名称(name)、描述(description)、作用对象(targetType)、触发时机(trigger)的属性。实例请参看 OriginSkill.attack 技能。

## 抽象

由于技能的需求不尽相同，所以需要抽象出一个框架来进行管理。进行抽象的部分暂时有：技能效果、触发时机、技能作用对象。当然这些只是最初步的想法，需要不断完善和重构才能做到更加灵活。


